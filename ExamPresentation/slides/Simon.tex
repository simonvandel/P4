\section{Compiler}

\subsection{F\# Evaluering}
\begin{frame}{F\# evaluering}
  \begin{columns}
    \begin{column}{.5\textwidth}
      \structure{Godt}
      \begin{itemize}
        \item Ny vinkel til programmering
        \item Kort og præcis kode
        \item Exhaustive checks ved pattern matching
      \end{itemize}
    \end{column}
    
    \begin{column}{.5\textwidth}
      \structure{Dårligt}
      \begin{itemize}
        \item Idiomatisk F\# undgår muteringer => mindre effektiv kode
        \item Nyt sprog at lære
        \item Ikke så meget compiler-læremateriale
      \end{itemize}
    \end{column}
  \end{columns}
\end{frame}

\subsection{Struktur}
\begin{frame}{Struktur}
\centering
\resizebox{1\textwidth}{!}{%
\begin{tikzpicture}[>=latex', node distance = 2cm]
        \tikzset{block/.style= {draw, rectangle, align=center,minimum width=1cm,minimum height=1cm},
        input/.style={ % requires library shapes.geometric
        draw,
        trapezium,
        trapezium left angle=60,
        trapezium right angle=120,
        minimum width=1cm,
        align=center,
        minimum height=0.5cm
    },
        }
        \node [coordinate]  (input) {};
        \node [block, right =1cm of input] (parser) {Parser};
        \node [block, above =1cm of parser] (parserErrors) {Errors};
        \node [block, right =2cm of parser] (toAST) {To AST};
        \node [block, right =1cm of toAST] (reass) {Reassignment check};
        \node [block, below =1cm of reass] (usebeforedecl) {Use before declared check};
        \node [block, left =2.2cm of usebeforedecl] (hiding) {Hiding check};
        \node [block, left =2.2cm of hiding] (typecheck) {Typecheck};
        \node [block, above =1cm of reass] (analyserErrors) {Errors};
        \node [block, below =1cm of typecheck] (codegen) {Code generator};
        \node [block, right =1.5cm of codegen] (clang) {Clang};
        \node [coordinate, right =2cm of clang] (nativeCode) {};
%% paths
        \path[draw,->] (input) edge node[anchor=south] {Input} (parser)
                    (parser) edge node[anchor=south] {Hime AST} (toAST)
                    (parser) edge (parserErrors)
                    (toAST) edge node[anchor=south] {AST} (reass)
                    (reass) edge node[anchor=west] {Symbol table} (usebeforedecl)
                    (usebeforedecl) edge node[anchor=north] {Symbol table} (hiding)
                    (hiding) edge node[anchor=north] {Symbol table} (typecheck)
                    (reass) edge (analyserErrors)
                    (typecheck) edge node[anchor=west] {AST} (codegen)
                    (codegen) edge node[anchor=south] {LLVM IR} (clang)
                    (clang) edge node[anchor=south] {Native Code} (nativeCode)
                    ;
       \path[draw, ->] (toAST) [dashed] edge (usebeforedecl)
                       (toAST) [dashed] edge (hiding)
                       (toAST) [dashed] edge (typecheck);
    \end{tikzpicture}
    }

\end{frame}

\subsection{Overgang Mellem Faser}
\begin{frame}[fragile]
  \frametitle{Overgang Mellem Faser}
  \begin{lstlisting}[language=fsharp]
parse input grammarPath 
>>= fun tree -> Success (toAST tree)
>>= analyse
>>= (fun ast -> Success (codeGen ast))
  \end{lstlisting}

  \begin{lstlisting}[language=fsharp]
let parse (srcInput:string) (grammarPath:string) : Result<ASTNode> = ...
  \end{lstlisting}

  \begin{lstlisting}[language=fsharp]
let rec toAST (root:ASTNode) : AST = ...
  \end{lstlisting}

  \begin{lstlisting}[language=fsharp]
type Result<'a> =
     | Success of 'a
     | Failure of string list
  \end{lstlisting}

  \begin{lstlisting}[language=fsharp]
let (>>=) (res:Result<'a>) (f:'a -> Result<'b>) : Result<'b> =
    match res with
    | Success r -> f r
    | Failure errs -> Failure errs
  \end{lstlisting}

  

\end{frame}

\subsection{Alternativ Compiler Struktur}
\begin{frame}{Alternativ Compiler Struktur}
  \begin{itemize}
    \item Dekorere AST igennem faser => undgå symbol tabel
    \item Mere uafhængig struktur => alting er transformationer
  \end{itemize}
\resizebox{1\textwidth}{!}{%
\begin{tikzpicture}[>=latex', node distance = 2cm]
        \tikzset{block/.style= {draw, rectangle, align=center,minimum width=1cm,minimum height=1cm},
        input/.style={ % requires library shapes.geometric
        draw,
        trapezium,
        trapezium left angle=60,
        trapezium right angle=120,
        minimum width=1cm,
        align=center,
        minimum height=0.5cm
    },
        }
        \node [coordinate]  (input) {};
        \node [block, right =1cm of input] (parser) {Parser};
        \node [block, above =1cm of parser] (parserErrors) {Errors};
        \node [block, right =2cm of parser] (toAST) {To AST};
        \node [block, right =1cm of toAST] (reass) {Reassignment check};
        \node [block, below =1cm of reass] (usebeforedecl) {Use before declared check};
        \node [block, left =2.4cm of usebeforedecl] (hiding) {Hiding check};
        \node [block, left =2.4cm of hiding] (typecheck) {Typecheck};
        \node [block, above =1cm of reass] (analyserErrors) {Errors};
        \node [block, below =1cm of typecheck] (codegen) {Code generator};
        \node [block, right =1.5cm of codegen] (clang) {Clang};
        \node [coordinate, right =2cm of clang] (nativeCode) {};
%% paths
        \path[draw,->] (input) edge node[anchor=south] {Input} (parser)
                    (parser) edge node[anchor=south] {Hime AST} (toAST)
                    (parser) edge (parserErrors)
                    (toAST) edge node[anchor=south] {AST} (reass)
                    (reass) edge node[anchor=west] {Decorated AST} (usebeforedecl)
                    (usebeforedecl) edge node[anchor=south] {Decorated AST} (hiding)
                    (hiding) edge node[anchor=south] {Decorated AST} (typecheck)
                    (reass) edge (analyserErrors)
                    (typecheck) edge node[anchor=west] {Decorated AST} (codegen)
                    (codegen) edge node[anchor=south] {LLVM IR} (clang)
                    (clang) edge node[anchor=south] {Native Code} (nativeCode)
                    ;
    \end{tikzpicture}
    }

\end{frame}